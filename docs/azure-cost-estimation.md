# Azure月額費用見積書

## 概要
本書は、Bicepファイル（`infrastructure/main.bicep`）に定義されたAzureリソースの月額費用を算出したものです。
価格は2024年12月時点の日本リージョン（Japan East）での標準価格を基準としています。

## デプロイされているリソース一覧

### 1. App Service Plan
- **リソース名**: `${appName}-plan`
- **SKU**: B1 (Basic)
- **種類**: Linux
- **用途**: Streamlitアプリケーションのホスティング

### 2. Web App for Container
- **リソース名**: `${appName}-webapp`
- **種類**: Linuxコンテナ（サイドカー対応）
- **常時稼働**: Yes (alwaysOn: true)
- **用途**: Dockerコンテナとして実行されるStreamlitアプリ

### 3. Azure Functions (Consumption Plan)
- **リソース名**: `${appName}-functions`
- **プラン**: Y1 (Dynamic/Consumption)
- **ランタイム**: Python 3.11
- **用途**: 定期的な自動投稿処理（将来実装予定）

### 4. Storage Account
- **リソース名**: `${appName}funcstor`
- **SKU**: Standard_LRS
- **種類**: StorageV2
- **アクセス層**: Hot
- **用途**: Azure Functions用ストレージ

### 5. Key Vault
- **リソース名**: `kv-${appName}`
- **SKU**: Standard
- **用途**: シークレット管理（APIキー、トークン等）

### 6. Application Insights
- **リソース名**: `${appName}-insights`
- **種類**: Web
- **用途**: アプリケーション監視とログ収集

### 7. Managed Identity
- **リソース名**: `${appName}-github-identity`
- **用途**: GitHub Actions OIDC認証

## 月額費用詳細

### 基本リソース費用

| リソース | SKU/プラン | 単価 | 数量 | 月額費用（USD） | 月額費用（JPY） |
|---------|-----------|------|------|----------------|----------------|
| **App Service Plan** | B1 (Basic) | $55.00/月 | 1 | $55.00 | ¥8,250 |
| **Azure Functions** | Consumption | 無料枠内* | - | $0.00 | ¥0 |
| **Storage Account** | Standard_LRS (Hot) | $0.0184/GB | ~1GB | $0.02 | ¥3 |
| **Key Vault** | Standard | $0.03/10,000トランザクション | ~1,000 | $0.00 | ¥0 |
| **Application Insights** | 基本プラン | 5GB/月まで無料 | <5GB | $0.00 | ¥0 |
| **Managed Identity** | - | 無料 | 1 | $0.00 | ¥0 |

**基本リソース月額合計**: **$55.02** (約**¥8,253**)

*Azure Functions Consumptionプラン: 月間40万GB-秒、100万実行まで無料

### データ転送費用（推定）

| 項目 | 単価 | 推定使用量/月 | 月額費用（USD） | 月額費用（JPY） |
|-----|------|-------------|----------------|----------------|
| **送信データ転送** | 最初の5GB無料、以降$0.087/GB | <5GB | $0.00 | ¥0 |
| **受信データ転送** | 無料 | - | $0.00 | ¥0 |

**データ転送月額合計**: **$0.00** (¥0)

### トランザクション費用（推定）

| 項目 | 単価 | 推定使用量/月 | 月額費用（USD） | 月額費用（JPY） |
|-----|------|-------------|----------------|----------------|
| **Storage トランザクション** | $0.0004/10,000 | ~100,000 | $0.004 | ¥1 |
| **Key Vault 操作** | $0.03/10,000 | ~10,000 | $0.03 | ¥5 |
| **Application Insights データ処理** | 5GB以降$2.30/GB | <5GB | $0.00 | ¥0 |

**トランザクション月額合計**: **$0.034** (約**¥6**)

## 月額費用サマリー

### 現在の構成での月額費用

| カテゴリ | 月額費用（USD） | 月額費用（JPY） |
|---------|----------------|----------------|
| 基本リソース | $55.02 | ¥8,253 |
| データ転送 | $0.00 | ¥0 |
| トランザクション | $0.034 | ¥6 |
| **合計** | **$55.054** | **約¥8,259** |

### 年間費用予測

| 期間 | 費用（USD） | 費用（JPY） |
|-----|------------|------------|
| 1ヶ月 | $55.054 | ¥8,259 |
| 3ヶ月 | $165.162 | ¥24,777 |
| 6ヶ月 | $330.324 | ¥49,554 |
| **12ヶ月** | **$660.648** | **¥99,108** |

## コスト最適化の提案

### 1. 即座に実施可能な最適化

#### App Service Plan のダウングレード
- **現在**: B1 ($55.00/月)
- **提案**: F1 Free ($0.00/月) - 開発/テスト環境の場合
- **節約額**: $55.00/月 (¥8,250/月)
- **制限事項**: 
  - 60分/日のCPU時間制限
  - カスタムドメイン不可
  - Always On不可

#### App Service Plan の使用時間最適化
- **現在**: B1 with Always On
- **提案**: B1 without Always On + 自動スケーリング
- **節約額**: 約30-40% (使用パターンによる)

### 2. 中期的な最適化

#### Azure Functions への完全移行
- **現在**: App Service (B1) + Functions (Consumption)
- **提案**: すべてFunctions (Consumption)に移行
- **節約額**: $55.00/月
- **メリット**: 
  - 使用した分だけの課金
  - 自動スケーリング
  - 月間無料枠が大きい

#### Reserved Instance の購入
- **1年予約**: 約22%割引 → $42.90/月
- **3年予約**: 約40%割引 → $33.00/月
- **節約額**: 
  - 1年: $12.10/月 (¥1,815/月)
  - 3年: $22.00/月 (¥3,300/月)

### 3. アーキテクチャ変更による最適化

#### Static Web Apps への移行（Next.js移植後）
- **現在**: App Service B1 ($55.00/月)
- **提案**: Azure Static Web Apps (Free tier)
- **節約額**: $55.00/月
- **制限**: 
  - 100GB帯域幅/月
  - カスタムドメイン2個まで

## 使用量増加時の費用予測

### トラフィック増加シナリオ

| シナリオ | 月間ユーザー数 | 推定月額費用（USD） | 推定月額費用（JPY） |
|---------|--------------|-------------------|-------------------|
| 現在（低） | ~100 | $55.054 | ¥8,259 |
| 中規模 | ~1,000 | $57.00 | ¥8,550 |
| 大規模 | ~10,000 | $75.00 | ¥11,250 |
| エンタープライズ | ~100,000 | $250.00+ | ¥37,500+ |

### スケールアップ時の料金

| App Service Plan | 月額費用（USD） | 月額費用（JPY） | 特徴 |
|-----------------|----------------|----------------|------|
| F1 (Free) | $0 | ¥0 | 開発/テスト用 |
| **B1 (現在)** | **$55.00** | **¥8,250** | 小規模サイト |
| B2 | $109.00 | ¥16,350 | 中規模サイト |
| S1 | $73.00 | ¥10,950 | 本番環境基本 |
| S2 | $146.00 | ¥21,900 | 本番環境標準 |
| P1V2 | $146.00 | ¥21,900 | 高性能 |

## Firebaseコスト（別途）

現在のアーキテクチャではFirebase/Firestoreを外部サービスとして使用：

| サービス | 無料枠 | 超過時の料金 | 推定月額 |
|---------|-------|-------------|---------|
| Firestore | 1GB storage, 50K reads/day | $0.18/GB, $0.06/100K reads | $0 (無料枠内) |
| Authentication | 無制限 | $0 | $0 |

## 総合的なコスト評価

### 現在の構成の特徴
- ✅ **シンプルな構成**: 管理が容易
- ✅ **拡張性**: 必要に応じてスケールアップ可能
- ⚠️ **コスト効率**: 小規模利用には若干オーバースペック
- ✅ **信頼性**: Always Onで常時稼働

### 推奨事項

#### 開発/テスト環境の場合
1. App Service PlanをF1 (Free)に変更
2. Always Onを無効化
3. **月額費用: $0** (¥0)

#### 本番環境（小規模）の場合
1. 現在の構成を維持（B1）
2. Application Insightsでコスト監視
3. **月額費用: $55** (¥8,250)

#### 本番環境（成長予定）の場合
1. 1年間のReserved Instanceを購入
2. Azure Cost Managementでアラート設定
3. **月額費用: $43** (¥6,450)

## 注意事項

1. **為替レート**: 1 USD = 150 JPYで計算（実際のレートは変動します）
2. **税金**: 表示価格は税抜きです
3. **地域差**: Japan Eastリージョンの価格を使用
4. **無料枠**: 新規アカウントの場合、最初の12ヶ月間は一部サービスが無料
5. **実際の請求**: 使用パターンにより変動する可能性があります

## まとめ

現在の構成での**月額費用は約$55（¥8,250）**です。これは小規模な本番環境として適切な構成ですが、以下の最適化により大幅なコスト削減が可能です：

- **開発環境**: Free tierへの変更で**100%削減**
- **本番環境**: Reserved Instanceで**22-40%削減**
- **将来的**: Static Web Apps移行で**最大100%削減**

定期的なコスト見直しとAzure Cost Managementの活用により、適切なコスト管理を推奨します。